{% extends 'base.html' %} {% block content %}

<h2>Scraping</h2>
<div class="start-scraping my-2">
  {% for spider in spiders %}
  <form class="form my-2" action="{% url 'scraping:spider' spider=spider.id %}" method="post">
    <input type="hidden" name="spider_type" value="{{spider.type}}" />
    <button class="btn btn-primary" type="submit">Launch "{{ spider.id }} {{spider.type}}" spider</button>
  </form>
  {% endfor %}
</div>
<h3>Tasks</h3>

<ul class="list-group list-group-flush">
  {% for task in scraped_tasks %}
  <li class="list-group-item">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#collapse_{{ task.id }}">Task {{ task.id }}, spider: {{ task.spider }}, type: {{task.spider_type}}</a>
    </h4>
    <div id="collapse_{{ task.id }}" class="panel-collapse collapse">
      <ul class="list-group list-group-flush">
        {% for item in task.items.all %}
        <li class="list-group-item">
          <p>{{ item.data }}</p>
          <p>{{ item.date }}</p>
          <form class="form" action="{% url 'scraping:postprocess-item' pk=item.id %}" method="post">
            {% csrf_token %}
            <button class="btn btn-primary" type="submit">Postprocess item</button>
          </form>
        </li>
        {% endfor %}
      </ul>
    </div>
  </li>
  {% endfor %}
</ul>

{% endblock %}
