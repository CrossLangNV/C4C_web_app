{% extends 'base.html' %}

{% block content %}

<h2>Scraping</h2>
<div class="start-scraping my-2">
    <form class="form my-2" action="{% url 'scraping:spider' spider='quotes' %}" method="post">
        <button class="btn btn-primary" type="submit">Launch "quotes" spider</button>
    </form>
    <form class="form" action="{% url 'scraping:spider' spider='eiopa' %}" method="post">
        <button class="btn btn-primary" type="submit">Launch "eiopa" spider</button>
    </form>
</div>
<h3>Tasks</h3>

<ul class="list-group list-group-flush">
    {% for task in scraped_tasks %}
        <li class="list-group-item">
            <h4 class="panel-title">
                <a data-toggle="collapse" href="#collapse_{{ task.id }}">Task {{ task.id }}, spider: {{ task.spider }}</a>
            </h4>
            <div id="collapse_{{ task.id }}" class="panel-collapse collapse">
                <ul class="list-group list-group-flush">
                    {% for item in task.items.all %}
                        <li class="list-group-item">
                            <p>{{ item.data }}</p>
                            <p>From spider: {{ task.spider }}</p>
                            <p>{{ item.date }}</p>
                            <form class="form" action="{% url 'scraping:postprocess' pk=item.id %}" method="post">
                                {% csrf_token %}
                                <button class="btn btn-primary" type="submit">Postprocess item</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </li>
    {% endfor %}
</ul>

{% endblock %}